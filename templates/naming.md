# 命名ガイドライン

## このドキュメントについて

データベースやバックエンドのコードにおける命名のガイドラインを示します。古いコードはこのガイドラインに沿っていない箇所が多くありますが、新たに書く部分についてはそれらを模倣せず、こちらのガイドラインに従ってください。関数の中の一部を修正する際など、前後との整合性を取る必要がある場合は既存のスタイルに合わせてください。

なお、CakePHP 標準をベースとします。

## このドキュメントが必要な理由

> 変数名またはクラスに適切なドメイン概念を使用すると、コードの読者が長期記憶で関連情報を見つけやすくなります。
> 
> フェリエンヌ・ヘルマンス,プログラマー脳 ～優れたプログラマーになるための認知科学に基づくアプローチ

> 興味深いことに、バトラー氏の研究では、命名の問題とコードの品質の間に統計的に有意な関連性があることが判明しました。 バトラー氏の調査結果は、不適切な命名スタイルは、単に読みにくい、理解できない、保守しにくいコードではなく、間違っている可能性が高いコードを示している可能性があることを示唆しています。
>
> フェリエンヌ・ヘルマンス,プログラマー脳 ～優れたプログラマーになるための認知科学に基づくアプローチ


認知負荷を減らすために命名は非常に重要な要素だからです。

## ガイドライン

> [!CAUTION]
> できるだけ以下のガイドラインに従ってください。ただし前述のとおり、前後のコードと整合性を取る必要がある場合は既存のスタイルに合わせてください。もし命名に悩むようであれば、他のメンバーに相談してください。

1. 単語は省略しない
2. 関数（メソッド）名は動詞から始める
3. メソッド名はローワーキャメルケースで統一する
4. プロパティ名はローワーキャメルケースで統一する
5. ローカル変数名はスネークケースで統一する[^1]
6. 変数名は次のとおり
    1. 論理値を示す名前は次のような論理値と分かる接頭辞から始める
        1. is, has, uses, should, can
        2. 論理値の配列の場合は list, array, values などの接尾辞をつけ、複数であることが分かるようにする
    2. 論理値と関数以外は動詞で始めずに名詞で終わる
    3. Table クラスのインスタンスは table 接尾辞をつける
        1. プロパティの場合は `$userstTable`
        2. ローカル変数の場合は `$users_table`
7. 単位を持つ値を格納する変数には接尾辞に単位を表す文字列をつける
    1. min, sec, kb, mb, g, kg, etc.
8. 配列の場合は複数形にする
9. 連想配列の場合はなにをキーに持つか分かるようにする

[^1]: [CakePHP のコーディング規約](https://book.cakephp.org/4/ja/contributing/cakephp-coding-conventions.html#id19)ではローワーキャメルケースですが、既存のコードがスネークケースで書かれているためこちらに統一します

## 例

### 1. 単語は省略しない

```php
// Best
$has_items = true;

// Bad
$ext_items = true;

// OK
// 省略された文字列が一般的に使われている場合（他には単位や IP アドレス、など）
$min_threshold = 1;
// pos(=position), val(=value) など文脈から明らかと思われる場合はOK
$pos = strpos(...);
// ループインデックス
for ($i = 0; ...)
```

### 2. 関数（メソッド）名は動詞から始める

```php
// Best
function collectColors() {...}

// Bad
function colorCollect() {...}

// Better 配列を返すことは伝わる
function colorCollection() {...}
```

### 6.a. 論理値を示す名前は次のような論理値と分かる接頭辞から始める

論理値のリストは `形容詞 + s` みたいな形式にしないために（スペルチェッカーがタイポと認識してしまうため）、後ろがリストを表すような `_array, _list, _values` などの名詞で終わるようにしてください。

```php
// Best
$is_disabled = false;
$has_items = true;
$uses_kit = true;
$should_be_removed = false;
$can_continue = true;

// Bad
$disable = false;

// Better
$disabled = false;

// 複数

// Best
$is_disabled_list = [false, true];

// Bad
$is_disableds = [false, true];

// Better フラグであることは接頭辞でわかる
$is_disabled_flags = [false, true];
```

### 7. 単位を持つ値を格納する変数には接尾辞に単位を表す文字列をつける

```php
// Best
$weight_kg = 10;

// Bad
$weight = 10;

// Better 省略しても意図が伝わる場合は省略が望ましいが、省略せずに書いてもOK
$weight_kilogram = 10;
```

### 8. 配列の場合は複数形にする

```php
// Good
$available_order_months = [1, 2, 3];

// Bad
$available_order_month = [1, 2, 3];
```

### 9. 連想配列の場合はなにをキーに持つか分かるようにする

`by` は `key by` または `group by` の意味（フルで書くと長くなるので `by` のみでOK）

```php
// Good
$meal_details_by_date = ['2024-01-01' => [...], '2024-01-02' => [...]];

// Bad
$dates = ['2024-01-01' => [...], '2024-01-02' => [...]];
```

余談ですが、関数のパラメータや戻り値に連想配列使う場合には、DocComment に以下のように書くといいでしょう。あとから読む人がわかりやすくなりますし、PhpStorm を使っていれば、キーの補完も効くようになります。

参考) https://psalm.dev/docs/annotating_code/type_syntax/array_types/#array-shapes